<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pip-Boy 3003</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000%22/><text x=%2250%25%22 y=%2250%25%22 font-size=%2280%22 font-family=%22monospace%22 font-weight=%22bold%22 fill=%22%231aff1a%22 dy=%22.35em%22 text-anchor=%22middle%22>P</text></svg>">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script>document.write('<link rel="stylesheet" href="style.css?v=' + Date.now() + '">');</script>
    <script>window.onerror=function(m,u,l){console.error("ERR:",m);if(typeof UI!=='undefined'&&UI.error)UI.error(m);return false;};</script>
</head>
<body>
<div id="pipboy-case">
    <div class="scanline"></div>
    <div class="absolute inset-0 pointer-events-none crt-flicker z-[1001]" style="background: rgba(0,255,0,0.02);"></div>

    <div id="login-screen" class="hex-bg">
        <div class="login-box crt-effect-container">
            
            <div id="boot-sequence">
                <div class="relative w-24 h-24 mb-4">
                    <svg class="w-full h-full text-green-500 gear-spin absolute inset-0 opacity-50" viewBox="0 0 100 100" fill="currentColor">
                        <path d="M50 0 L60 10 L70 5 L80 15 L75 25 L85 30 L95 25 L100 35 L90 45 L95 55 L100 60 L90 70 L80 65 L75 75 L85 85 L75 95 L65 90 L60 100 L50 100 L40 90 L30 95 L20 85 L25 75 L15 70 L5 75 L0 65 L10 55 L5 45 L15 35 L5 25 L15 15 L25 20 L30 10 L40 0 Z" />
                        <circle cx="50" cy="50" r="20" fill="black" />
                    </svg>
                    <svg class="w-16 h-16 text-yellow-400 absolute inset-0 m-auto vault-wink" viewBox="0 0 100 100" fill="currentColor">
                        <path d="M20 30 Q50 10 80 30 Q90 50 80 80 Q50 100 20 80 Q10 50 20 30 Z" />
                        <path d="M20 30 Q50 0 80 30" fill="#ccaa00" /> <circle cx="35" cy="50" r="5" fill="black" />
                        <circle cx="65" cy="50" r="5" fill="black" />
                        <path d="M40 70 Q50 80 60 70" stroke="black" stroke-width="3" fill="none" /> </svg>
                </div>
                <div class="text-xl font-bold text-yellow-400 mb-2 animate-pulse">PLEASE STAND BY</div>
                <div id="boot-log" class="w-full text-left pl-4 border-l border-green-900 mt-2 h-32 overflow-hidden flex flex-col justify-end"></div>
            </div>

            <div id="login-content" class="hidden w-full flex-col items-center">
                <h1 class="text-5xl md:text-6xl font-bold glow-text mb-2">PIP-BOY 3003</h1>
                <div id="login-title" class="text-xl mb-4 opacity-80 animate-pulse">AUTHENTICATION REQUIRED</div>
                <form id="login-form" onsubmit="event.preventDefault();" autocomplete="off" class="w-full">
                    <input type="email" id="login-email" class="login-input" placeholder="E-MAIL" autofocus autocomplete="username">
                    <input type="password" id="login-pass" class="login-input mt-2" placeholder="PASSWORT" autocomplete="current-password">
                    <input type="text" id="login-name" class="login-input hidden mt-2" placeholder="ACCOUNT NAME" maxlength="15" autocomplete="off" style="display: none;">
                </form>
                <button id="btn-login" class="action-button w-full py-3 font-bold text-xl mb-2 mt-4">LOGIN</button>
                <button id="btn-toggle-register" class="text-sm text-yellow-400 hover:text-yellow-200 cursor-pointer mb-4 underline bg-transparent border-none">Noch kein Account? Hier registrieren</button>
                <div class="flex gap-2 w-full">
                    <button id="btn-manual-login" class="action-button flex-1 py-2 font-bold text-lg border-yellow-400 text-yellow-400" onclick="UI.showManualOverlay()">ANLEITUNG</button>
                    <button id="btn-changelog" class="action-button flex-1 py-2 font-bold text-lg border-blue-400 text-blue-400" onclick="UI.showChangelogOverlay()">LOGS</button>
                </div>
                
                <button onclick="window.location.href='admin.html'" class="mt-2 text-[10px] text-gray-600 hover:text-red-500 border border-transparent hover:border-red-900 px-2 py-1 transition-colors uppercase tracking-widest cursor-pointer bg-transparent">
                    [ ADMIN TERMINAL ACCESS ]
                </button>

                <div id="login-status" class="mt-4 text-yellow-400 min-h-[1.5em] text-sm font-mono break-words"></div>
                <div class="mt-4 text-xs text-[#1aff1a] opacity-50 border-t border-[#1aff1a]/30 pt-2 w-full">VERSION <span id="login-version-display">LOADING...</span></div>
            </div>

        </div>
    </div>

       <div id="char-select-screen" style="display: none;">
        <div class="login-box crt-effect-container w-full max-w-lg">
            <h1 class="text-4xl font-bold text-yellow-400 mb-4 border-b border-yellow-400 pb-2">CHARAKTER WAHL</h1>
            <div class="text-xs mb-4 text-green-300">WÃ¤hle einen Slot.</div>
            
            <div id="char-slots-list" class="flex flex-col gap-2 w-full mb-4">
                </div>
            
            <div class="flex flex-col gap-2 w-full mb-4">
                <button id="btn-char-select-action" class="action-button w-full font-bold border-yellow-400 text-yellow-400 py-3">CHARAKTER ERSTELLEN</button>
                <div class="flex gap-2 w-full">
                    <button id="btn-char-delete-action" class="action-button flex-1 font-bold border-red-500 text-red-500 py-2" disabled>LÃ–SCHEN</button>
                    <button id="btn-char-back" class="action-button flex-1 border-gray-500 text-gray-500 py-2">ZURÃœCK</button>
                </div>
            </div>
        </div>
    </div>

    <div id="delete-confirm-overlay" style="display: none;">
        <div class="login-box crt-effect-container border-red-500" style="box-shadow: 0 0 30px red;">
            <h2 class="text-3xl font-bold text-red-600 mb-2">WARNUNG</h2>
            <p class="text-red-400 mb-4">Charakter unwiderruflich lÃ¶schen?<br>Tippe den Namen zur BestÃ¤tigung:</p>
            <div id="delete-target-name" class="font-bold text-white mb-2 text-xl bg-red-900/50 p-2 border border-red-500">???</div>
            <input type="text" id="delete-input" class="login-input border-red-500 text-red-500 mb-4" placeholder="NAME EINGEBEN" autocomplete="off">
            <div class="flex gap-2 w-full">
                <button id="btn-delete-confirm" class="action-button flex-1 border-red-500 text-red-500 font-bold" disabled>LÃ–SCHEN</button>
                <button id="btn-delete-cancel" class="action-button flex-1 border-green-500 text-green-500">ABBRECHEN</button>
            </div>
        </div>
    </div>
    
    <div id="new-char-overlay" class="absolute inset-0 z-[1000] bg-black/95 flex flex-col justify-center items-center hidden">
        <div class="login-box crt-effect-container border-yellow-400">
            <h2 class="text-3xl font-bold text-yellow-400 mb-2">NEUE IDERNTITÃ„T</h2>
            <p class="text-green-300 mb-4">Wie soll dein neuer Charakter heiÃŸen?</p>
            <input type="text" id="new-char-name" class="login-input mb-4 text-yellow-400 border-yellow-400" placeholder="NAME" maxlength="15">
            <div class="flex gap-2 w-full">
                <button id="btn-create-char" class="action-button flex-1 border-yellow-400 text-yellow-400 font-bold">ERSTELLEN</button>
                <button onclick="document.getElementById('new-char-overlay').classList.add('hidden')" class="action-button flex-1">ABBRUCH</button>
            </div>
        </div>
    </div>

    <div id="manual-overlay" class="hidden z-[1000] bg-black/95" style="display: none;"><div class="border-2 border-yellow-400 w-full max-w-2xl h-[90vh] bg-[#111] flex flex-col p-4 shadow-[0_0_30px_#aa0]"><div class="flex justify-between items-center border-b border-yellow-400 pb-2 mb-2"><h2 class="text-2xl font-bold text-yellow-400">HANDBUCH v1.0</h2><button class="text-red-500 font-bold text-xl px-2 border border-red-500 hover:bg-red-900" onclick="document.getElementById('manual-overlay').classList.add('hidden'); document.getElementById('manual-overlay').style.display='none';">X</button></div><div id="manual-content" class="flex-grow overflow-y-auto text-green-300 font-mono space-y-4 pr-2"></div></div></div>
    <div id="changelog-overlay" class="hidden z-[1000] bg-black/95" style="display: none;"><div class="border-2 border-blue-400 w-full max-w-2xl h-[90vh] bg-[#050510] flex flex-col p-4 shadow-[0_0_30px_#00a]"><div class="flex justify-between items-center border-b border-blue-400 pb-2 mb-2"><h2 class="text-2xl font-bold text-blue-400">PATCH NOTES</h2><button class="text-red-500 font-bold text-xl px-2 border border-red-500 hover:bg-red-900" onclick="document.getElementById('changelog-overlay').classList.add('hidden'); document.getElementById('changelog-overlay').style.display='none';">X</button></div><div id="changelog-content" class="flex-grow overflow-y-auto text-blue-200 font-mono text-sm leading-relaxed whitespace-pre-wrap pr-2"></div></div></div>
    <div id="spawn-screen" style="display: none;"><div class="login-box crt-effect-container"><h1 class="text-3xl md:text-4xl font-bold glow-text mb-4">NEUER CHARAKTER</h1><div id="spawn-msg" class="text-sm mb-4 text-red-400 font-bold"></div><div id="spawn-list" class="flex flex-col gap-2 max-h-[250px] overflow-y-auto mb-4 border border-green-900 p-2 text-left"></div><button id="btn-spawn-random" class="action-button w-full mb-2">ZUFALLS-START</button><button class="action-button w-full border-red-500 text-red-500" onclick="location.reload()">ABBRUCH</button></div></div>
    <div id="reset-overlay" style="display: none;"><div class="login-box crt-effect-container border-red-500" style="box-shadow: 0 0 20px #500;"><h1 class="text-4xl font-bold text-red-500 mb-4 animate-pulse">ACHTUNG!</h1><div class="text-lg mb-8 text-red-400 font-bold">CHARAKTER LÃ–SCHEN?<br>ALLES GEHT VERLOREN!</div><div class="flex flex-col gap-2 w-full"><button id="btn-confirm-reset" class="action-button w-full border-red-500 text-red-500 font-bold hover:bg-red-900">JA, LÃ–SCHEN</button><button id="btn-cancel-reset" class="action-button w-full border-green-500 text-green-500">ABBRECHEN</button></div></div></div>
    <div id="game-over-screen" class="absolute inset-0 z-50 bg-black/95 flex flex-col justify-center items-center hidden"><h1 class="text-6xl text-red-600 font-bold border-4 border-red-600 p-6 mb-6 blink-red tracking-widest">CRITICAL FAILURE</h1><button id="btn-restart" onclick="location.reload()" class="border-2 border-red-500 text-red-500 px-8 py-3 hover:bg-red-900 text-xl font-bold uppercase cursor-pointer">NEUSTART</button></div>
    <div id="player-list-overlay"><div class="font-bold border-b border-green-500 mb-2 pb-1 text-center">SIGNALE</div><div id="player-list-content" class="text-sm space-y-1"></div><button class="action-button w-full mt-2 text-xs" onclick="UI.togglePlayerList()">SCHLIESSEN</button></div>

    <div id="game-screen" class="hidden opacity-0 transition-opacity duration-1000 bg-[#000]">
        
        <header class="flex flex-col w-full z-30 shrink-0 relative bg-[#001100] border-b-2 border-[#39ff14]">
            <div class="flex items-center justify-between p-2 gap-2 h-16 w-full">
                
                <div id="header-char-info" class="flex flex-col justify-center cursor-pointer hover:bg-green-900/30 px-2 rounded transition-colors group">
                    <span id="val-name" class="text-xl font-bold text-cyan-400 uppercase tracking-wide truncate group-hover:text-yellow-400 transition-colors">PLAYER</span>
                    <span class="text-yellow-400 font-bold text-sm leading-none">LVL <span id="val-lvl">1</span></span>
                </div>

                <div class="flex flex-col items-end justify-center gap-0 leading-tight min-w-[60px]">
                    <span class="text-yellow-400 font-bold text-sm whitespace-nowrap"><span id="val-caps" class="text-lg">0</span> KK</span>
                    <span class="text-yellow-400 font-bold text-sm whitespace-nowrap"><span id="val-ammo" class="text-lg">0</span> MUN</span>
                </div>

                <div class="flex-grow h-8 bg-gray-900 border border-[#39ff14] relative overflow-hidden mx-2 max-w-lg">
                    <div id="bar-hp" class="absolute top-0 left-0 h-full bg-[#1aff1a] transition-all duration-300 z-0" style="background: transparent; width: 100%"></div>
                    <div id="bar-rads" class="absolute top-0 right-0 h-full bg-red-600/90 transition-all duration-300 border-l border-red-400 z-10" style="width: 0%"></div>
                    <div id="val-hp" class="absolute inset-0 text-3xl tracking-widest flex items-center justify-center font-bold leading-none z-20 text-black" style="color: black !important;">TP 100/100</div>
                </div>

                <button id="btn-menu-toggle" class="header-btn border-[#39ff14] text-3xl h-full aspect-square flex items-center justify-center p-0" title="MenÃ¼">â˜°</button>
            </div>

            <div class="w-full h-2 bg-gray-900 border-t border-yellow-500 relative">
                 <div id="bar-exp-top" class="absolute top-0 left-0 h-full bg-yellow-500 transition-all duration-300" style="width: 0%"></div>
                 <div class="absolute inset-0 text-[8px] flex items-center justify-center text-black font-bold leading-none opacity-50"><span id="val-xp-txt">0</span>% XP</div>
            </div>
        </header>

        <div id="main-nav" class="hidden absolute top-20 right-0 z-[100] flex-col bg-black border-2 border-[#39ff14] p-2 gap-2 shadow-[0_5px_15px_#000] w-56">
            <button id="btn-inv" class="action-button w-full text-left">INVENTAR</button>
            <button id="btn-char" class="action-button w-full text-left">CHARAKTER</button>
            <button id="btn-map" class="action-button w-full text-left">WELT</button>
            <button id="btn-quests" class="action-button w-full text-left">AUFGABEN</button>
            <button id="btn-highscores-game" class="action-button w-full text-left" onclick="UI.showHighscoreBoard()">VAULT LEGENDS</button>
            <button id="btn-wiki" class="action-button w-full text-left">WIKI</button>
            <button id="btn-radio" class="action-button w-full text-left" onclick="UI.switchView('radio')">RADIO ðŸ“»</button>
            
            <button id="btn-manual-game" class="action-button w-full text-left text-yellow-400 border-yellow-400" onclick="UI.showManualOverlay()">HANDBUCH</button>
            <div class="border-t border-green-900 my-1"></div>
            <button id="btn-menu-save" class="action-button w-full text-left border-yellow-400 text-yellow-400">SPEICHERN</button>
            <button id="btn-logout" class="action-button w-full text-left text-red-400 border-red-500">LOGOUT</button>
            <div class="text-[10px] text-center text-white opacity-80 mt-1"><span id="val-players">?</span> USER | v<span id="version-display">...</span></div>
        </div>
        
        <div id="main-content">
            <div id="main-panel">
                <div id="layout-split">
                    <div id="view-container" class="crt-effect-container">
                        <button id="btn-toggle-dpad" class="hidden">ðŸŽ®</button>
                        <div id="overlay-controls"></div>
                        <div id="dialog-overlay"></div>
                        <div id="dice-overlay" class="hidden"></div>
                    </div>
                    <div id="log-panel">
                        <div class="bg-[#1aff1a] text-black font-bold px-2 flex justify-between items-center flex-shrink-0" style="box-shadow: 0 0 10px #1aff1a;"><h2>LOG</h2><span id="game-timer" class="font-mono text-sm">00:00:00</span></div>
                        <div id="log-area" class="flex-grow overflow-y-auto p-2 text-sm flex flex-col-reverse font-mono leading-relaxed text-green-400 cursor-pointer"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function loadScript(src) { return new Promise((resolve, reject) => { const s = document.createElement('script'); s.src = src; s.onload = resolve; s.onerror = reject; document.body.appendChild(s); }); }
    
    // BOOT SEQUENCE LOGIC
    function runBootSequence(ver) {
        const bootLines = [
            "ROBCO INDUSTRIES UNIFIED OPERATING SYSTEM",
            "COPYRIGHT 2075-2077 ROBCO INDUSTRIES",
            "SERVER: ONLINE",
            `LOADING SYSTEM VERSION ${ver || 'DETECTING...'}`,
            "MEMORY: 64KB OK",
            "BIO-METRICS: NOT FOUND",
            "INITIALIZING PIP-BOY 3003 INTERFACE..."
        ];
        const log = document.getElementById('boot-log');
        const bootSeq = document.getElementById('boot-sequence');
        const loginContent = document.getElementById('login-content');
        let delay = 1500; // Start nach kurzer Wartezeit fÃ¼r Animation
        
        bootLines.forEach((line, i) => {
            setTimeout(() => {
                const div = document.createElement('div');
                div.className = "boot-line";
                div.textContent = "> " + line;
                log.appendChild(div);
            }, delay);
            delay += 600 + Math.random() * 400; // ZufÃ¤llige VerzÃ¶gerung
        });

        // Nach Boot Sequence zum Login wechseln
        setTimeout(() => {
            bootSeq.style.display = 'none';
            loginContent.classList.remove('hidden');
            loginContent.classList.add('flex');
        }, delay + 1000);
    }

    // [v0.9.8] MAIN INIT - FORCE NO CACHE
    window.onload = function() {
        const verDisplay = document.getElementById('version-display');
        const loginVerDisplay = document.getElementById('login-version-display'); 
        
        // Use current timestamp as version to force re-fetch
        const devVer = Date.now();
        console.log("[PipBoy3003] Dev Mode Active. Force Loading ID:", devVer);

        // Fetch Version file purely for display purposes
        fetch('Version?t=' + devVer).then(res => res.text()).then(v => {
            const displayVer = v.trim(); // Version string from file (e.g. 0.9.7)
            
            runBootSequence(displayVer);

            if(verDisplay) { verDisplay.textContent = displayVer; verDisplay.classList.remove('animate-pulse'); }
            if(loginVerDisplay) { loginVerDisplay.textContent = displayVer; }
            
            // LOAD SCRIPTS WITH TIMESTAMP (devVer) TO IGNORE CACHE
            loadScript('data_core.js?v=' + devVer)
                .then(() => loadScript('world_gen.js?v=' + devVer))
                .then(() => loadScript('network.js?v=' + devVer))
                .then(() => loadScript('minigames.js?v=' + devVer))
                .then(() => loadScript('combat.js?v=' + devVer))
                                // NEW DATA ORDNER
                .then(() => loadScript('data/data_items.js?v=' + devVer))
                .then(() => loadScript('data/data_recipes.js?v=' + devVer))
                .then(() => loadScript('data/data_monsters.js?v=' + devVer))
                                // NEW GAME ORDNER
                .then(() => loadScript('game/game_core.js?v=' + devVer))
                .then(() => loadScript('game/game_map.js?v=' + devVer))
                .then(() => loadScript('game/game_actions.js?v=' + devVer))
                .then(() => loadScript('game/game_render.js?v=' + devVer))
                                // NEW UI ORDNERR
                .then(() => loadScript('ui/ui_core.js?v=' + devVer))
                .then(() => loadScript('ui/ui_render_core.js?v=' + devVer))
                .then(() => loadScript('ui/ui_view_inv.js?v=' + devVer))
                .then(() => loadScript('ui/ui_view_world.js?v=' + devVer))
                .then(() => loadScript('ui/ui_view_town.js?v=' + devVer))
                .then(() => loadScript('ui/ui_view_journal.js?v=' + devVer))
                .then(() => loadScript('ui/ui_view_city.js?v=' + devVer))
                .then(() => loadScript('ui/ui_view_camp.js?v=' + devVer))
                .then(() => loadScript('ui/ui_render_views.js?v=' + devVer))
                .then(() => loadScript('ui/ui_render_minigames.js?v=' + devVer))
                .then(() => loadScript('ui/ui_render_overlays.js?v=' + devVer))
                .then(() => loadScript('ui/ui_input.js?v=' + devVer))
                .then(() => { if(typeof UI !== 'undefined') UI.init(); console.log("System Ready."); })
                .catch(err => {
                    console.error("Critical Load Error:", err);
                    if(document.getElementById('login-status')) document.getElementById('login-status').innerHTML = '<span style="color:red">CRITICAL ERROR: FILE MISSING OR CORRUPT.<br>CHECK CONSOLE.</span>';
                });
        });
    };
</script>
</body>
</html>
