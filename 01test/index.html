<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pip-Boy 3000 Mk-V</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000%22/><text x=%2250%25%22 y=%2250%25%22 font-size=%2280%22 font-family=%22monospace%22 font-weight=%22bold%22 fill=%22%231aff1a%22 dy=%22.35em%22 text-anchor=%22middle%22>P</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --pip-green: #1aff1a; --pip-glow: #2bff2b; --pip-dim: #0d330d; --pip-bg: #051105; }
        body { background-color: #000; color: var(--pip-green); font-family: 'VT323', monospace; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; overflow: hidden; user-select: none; }
        #pipboy-case { background: linear-gradient(145deg, #1a1a1a, #0d0d0d); padding: 15px; border-radius: 30px; box-shadow: inset 0 0 20px #000, 0 0 0 5px #2a2a2a, 0 0 30px rgba(0,0,0,0.8); width: 100%; max-width: 1200px; height: 98vh; display: flex; flex-direction: column; position: relative; }
        #game-screen { background-color: var(--pip-bg); border: 2px solid var(--pip-dim); border-radius: 10px; flex-grow: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        .crt-effect-container { position: relative; overflow: hidden; background-color: #000; }
        .crt-effect-container::before { content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03)); z-index: 10; background-size: 100% 3px, 4px 100%; pointer-events: none; }
        .crt-effect-container::after { content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0; background: rgba(18, 16, 16, 0.05); opacity: 0; z-index: 10; pointer-events: none; animation: flicker 0.15s infinite; }
        .glow-text { text-shadow: 0 0 5px var(--pip-glow); }
        #main-content { flex-grow: 1; display: flex; overflow: hidden; min-height: 0; }
        #main-panel { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; min-height: 0; }
        #layout-split { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; min-height: 0; }
        @media (min-width: 768px) { #layout-split { flex-direction: row; } }
        #view-container { position: relative; flex-grow: 1; display: flex; justify-content: center; align-items: center; height: 60%; border-right: 2px solid var(--pip-green); }
        @media (min-width: 768px) { #view-container { width: 70%; height: 100%; border-bottom: none; } }
        #log-panel { display: flex; flex-direction: column; flex-shrink: 0; border-top: 2px solid var(--pip-green); height: 40%; min-height: 150px; background-color: #020a02; }
        @media (min-width: 768px) { #log-panel { width: 30%; height: 100%; border-top: none; border-left: none; } }
        .header-bar { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 1rem; border-bottom: 2px solid var(--pip-green); background: #0a1f0a; flex-shrink: 0; }
        .action-button { background-color: #0f1f0f; color: var(--pip-green); border: 1px solid var(--pip-green); padding: 5px 12px; margin: 2px; cursor: pointer; text-transform: uppercase; font-size: 1.25rem; transition: all 0.1s; font-family: 'VT323', monospace; }
        .action-button:hover { background-color: var(--pip-green); color: black; }
        .action-button:active { transform: scale(0.95); }
        .action-button:disabled { opacity: 0.3; cursor: not-allowed; border-color: #333; color: #555; }
        #btn-toggle-dpad { position: absolute; bottom: 20px; left: 20px; z-index: 100; width: 50px; height: 50px; border-radius: 50%; background: rgba(0, 0, 0, 0.8); border: 2px solid var(--pip-green); color: var(--pip-green); font-size: 24px; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 0 10px var(--pip-glow); }
        #dice-overlay { position: absolute; inset: 0; z-index: 80; background: rgba(0,0,0,0.95); flex-direction: column; justify-content: center; align-items: center; }
        .dice-box { width: 80px; height: 80px; border: 4px solid var(--pip-green); border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 50px; font-weight: bold; background: #000; color: var(--pip-green); box-shadow: 0 0 20px var(--pip-glow); }
        @keyframes flicker { 0% { opacity: 0.02; } 5% { opacity: 0.05; } 10% { opacity: 0.01; } 15% { opacity: 0.06; } 100% { opacity: 0.02; } }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-thumb { background: var(--pip-green); border-radius: 3px; } ::-webkit-scrollbar-track { background: #020a02; }
        .blink-red { animation: blink-red-anim 1s infinite; }
        @keyframes blink-red-anim { 0%, 100% { opacity: 1; color: red; } 50% { opacity: 0.5; } }
        
        #login-screen, #spawn-screen { position: absolute; inset: 0; z-index: 999; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box { border: 2px solid var(--pip-green); padding: 40px; text-align: center; box-shadow: 0 0 20px var(--pip-dim); max-width: 90%; }
        #survivor-id-input { background: #000; border: 2px solid var(--pip-green); color: var(--pip-green); font-family: inherit; font-size: 24px; padding: 10px; margin: 20px 0; text-align: center; text-transform: uppercase; outline: none; }
        #survivor-id-input:focus { box-shadow: 0 0 15px var(--pip-green); }
        
        #player-list-overlay { position: absolute; top: 60px; right: 20px; z-index: 90; background: rgba(0, 0, 0, 0.95); border: 2px solid var(--pip-green); padding: 10px; min-width: 200px; display: none; flex-direction: column; box-shadow: 0 0 15px var(--pip-dim); }
    </style>
    <script>window.onerror=function(m,u,l){console.error("ERR:",m);if(typeof UI!=='undefined'&&UI.error)UI.error(m);return false;};</script>
</head>
<body>
<div id="pipboy-case">
    <div id="login-screen">
        <div class="login-box crt-effect-container" style="position: relative; min-width: 300px;">
            <h1 class="text-6xl font-bold glow-text mb-2">PIP-BOY 3000</h1>
            <div class="text-xl mb-8 opacity-80">AUTHENTICATION REQUIRED</div>
            <div class="text-lg">BITTE SURVIVOR-ID EINGEBEN:</div>
            <input type="text" id="survivor-id-input" placeholder="Z.B. MAX_POWER" maxlength="15" autofocus>
            <br>
            <button id="btn-login" class="action-button px-8 py-3 text-2xl font-bold mt-4">VERBINDEN</button>
            <div id="login-status" class="mt-4 text-yellow-400 min-h-[1.5em] text-sm font-mono"></div>
            <div class="mt-8 text-xs text-[#1aff1a] opacity-50 border-t border-[#1aff1a]/30 pt-2 w-full">
                SYSTEM VERSION <span id="login-version-display">LOADING...</span>
            </div>
        </div>
    </div>

    <div id="spawn-screen" style="display: none;">
        <div class="login-box crt-effect-container" style="min-width: 350px;">
            <h1 class="text-4xl font-bold glow-text mb-4">NEUER CHARAKTER</h1>
            <div id="spawn-msg" class="text-sm mb-4 text-red-400 font-bold"></div>
            <div class="text-lg mb-4 text-cyan-400">WO M√ñCHTEST DU STARTEN?</div>
            
            <div id="spawn-list" class="flex flex-col gap-2 max-h-[300px] overflow-y-auto mb-4 border border-green-900 p-2">
                <div class="text-center italic opacity-50">Scanne Netzwerk...</div>
            </div>

            <button id="btn-spawn-random" class="action-button w-full mb-2">ZUFALL IM √ñDLAND</button>
            <button class="action-button w-full border-red-500 text-red-500" onclick="location.reload()">ABBRUCH</button>
        </div>
    </div>

    <div id="game-over-screen" class="absolute inset-0 z-50 bg-black/95 flex flex-col justify-center items-center hidden">
        <h1 class="text-6xl text-red-600 font-bold border-4 border-red-600 p-6 mb-6 blink-red tracking-widest">CRITICAL FAILURE</h1>
        <button onclick="location.reload()" class="border-2 border-red-500 text-red-500 px-8 py-3 hover:bg-red-900 text-xl font-bold uppercase cursor-pointer">SYSTEM REBOOT</button>
    </div>
    
    <div id="player-list-overlay">
        <div class="font-bold border-b border-green-500 mb-2 pb-1 text-center">AKTIVE SIGNALE</div>
        <div id="player-list-content" class="text-sm space-y-1"></div>
        <button class="action-button w-full mt-2 text-xs" onclick="UI.togglePlayerList()">SCHLIESSEN</button>
    </div>
    
    <div id="game-screen" class="hidden opacity-0 transition-opacity duration-1000">
        <header class="header-bar flex-wrap md:flex-nowrap gap-2 py-2 relative">
            <div class="flex flex-row items-center w-1/2 md:w-1/4 justify-start">
                <div class="font-bold text-lg md:text-xl leading-none whitespace-nowrap" style="text-shadow: 0 0 5px var(--pip-green);">
                    PIP-BOY <span class="text-xs opacity-70 hidden md:inline">MK-V</span>
                </div>
                <div id="current-zone-display" class="text-xs opacity-90 leading-none text-[#aaffaa] ml-2 truncate max-w-[120px]">Init...</div>
            </div>
            <div class="hidden md:flex w-1/4 justify-center">
                <span id="version-display" class="text-yellow-400 font-bold tracking-widest text-xs animate-pulse">...</span>
            </div>
            <div class="flex items-center justify-end gap-2 w-1/2 md:w-1/2">
                <button id="btn-logout" class="action-button px-3 py-1 text-sm md:text-base border-red-500 text-red-400">LOGOUT</button>
                <button id="btn-save" class="action-button px-3 py-1 text-sm md:text-base border-blue-500 text-blue-400 font-bold">SAVE</button>
                <button id="btn-menu-toggle" class="action-button px-3 py-1 text-base font-bold flex items-center gap-1">MEN√ú <span class="text-xl leading-none">‚ò∞</span></button>
                <div id="main-nav" class="hidden absolute top-full right-0 z-50 flex-col bg-black border-2 border-[#1aff1a] p-2 gap-2 shadow-[0_0_15px_#0d330d] min-w-[160px]">
                    <button id="btn-inv" class="action-button w-full text-left px-2 py-2 text-base font-bold text-yellow-400 border-yellow-400">INVENTAR</button>
                    <button id="btn-wiki" class="action-button w-full text-left px-2 py-2 text-base">WIKI</button>
                    <button id="btn-map" class="action-button w-full text-left px-2 py-2 text-base">WELT</button>
                    <button id="btn-char" class="action-button w-full text-left px-2 py-2 text-base">CHARAKTER</button>
                    <button id="btn-quests" class="action-button w-full text-left px-2 py-2 text-base">AUFGABEN</button>
                </div>
            </div>
        </header>
        <div id="system-status-bar" class="flex justify-between items-center px-4 py-2 border-b-2 border-[#1aff1a] bg-[#0a1f0a]">
            <div class="flex items-center gap-4 text-sm md:text-base">
                <div class="flex items-center gap-1"><span>TP:</span><span id="val-hp">--/--</span><div class="w-16 md:w-24 bg-black h-3 border border-[#1a4d1a]"><div id="bar-hp" class="bg-[#1aff1a] h-full" style="width: 100%"></div></div></div>
                <span>LVL: <span id="val-lvl">-</span></span>
                <div class="flex items-center gap-1"><span>XP:</span><div class="w-16 md:w-24 bg-black h-3 border border-yellow-900"><div id="bar-exp-top" class="bg-yellow-500 h-full" style="width: 0%"></div></div></div>
                <span>MUN: <span id="val-ammo">-</span></span>
            </div>
            <div class="flex gap-4">
                <span id="val-players" class="text-cyan-400 font-bold glow-text cursor-pointer hover:text-white" title="Spielerliste anzeigen">0 ONLINE</span>
                <span id="val-caps" class="text-yellow-400 font-bold glow-text">--- Caps</span>
            </div>
        </div>
        <div id="main-content">
            <div id="main-panel">
                <div id="layout-split">
                    <div id="view-container" class="crt-effect-container">
                        <button id="btn-toggle-dpad">üéÆ</button>
                        <div id="overlay-controls" style="display:none; position: absolute; bottom: 80px; left: 20px; z-index: 60; grid-template-columns: repeat(3, 1fr); gap: 5px;">
                             <div></div><button class="dpad-btn" id="btn-up" style="width: 50px; height: 50px; background: rgba(0,20,0,0.9); border: 2px solid #1aff1a; color: #1aff1a; font-size: 24px; display: flex; justify-content: center; align-items: center; border-radius: 8px;">‚ñ≤</button><div></div>
                             <button class="dpad-btn" id="btn-left" style="width: 50px; height: 50px; background: rgba(0,20,0,0.9); border: 2px solid #1aff1a; color: #1aff1a; font-size: 24px; display: flex; justify-content: center; align-items: center; border-radius: 8px;">‚óÄ</button><div class="flex items-center justify-center text-[#1aff1a]">‚óè</div><button class="dpad-btn" id="btn-right" style="width: 50px; height: 50px; background: rgba(0,20,0,0.9); border: 2px solid #1aff1a; color: #1aff1a; font-size: 24px; display: flex; justify-content: center; align-items: center; border-radius: 8px;">‚ñ∂</button>
                             <div></div><button class="dpad-btn" id="btn-down" style="width: 50px; height: 50px; background: rgba(0,20,0,0.9); border: 2px solid #1aff1a; color: #1aff1a; font-size: 24px; display: flex; justify-content: center; align-items: center; border-radius: 8px;">‚ñº</button><div></div>
                        </div>
                        <div id="dialog-overlay"></div>
                        <div id="dice-overlay" class="hidden">
                            <h2 class="text-5xl text-yellow-400 mb-8 font-bold animate-pulse">LEGEND√ÑR!</h2>
                            <div class="flex gap-6 mb-8"><div id="dice-1" class="dice-box">?</div><div id="dice-2" class="dice-box">?</div><div id="dice-3" class="dice-box">?</div></div>
                            <div class="text-2xl mb-6 text-center font-bold"><div class="text-cyan-400">3-7: KRONKORKEN</div><div class="text-cyan-400">8-12: MUNITION</div><div class="text-yellow-400">13-18: OVERDRIVE</div></div>
                            <button id="btn-roll" class="action-button px-10 py-4 text-3xl border-yellow-400 text-yellow-400 hover:bg-yellow-900" onclick="UI.rollDiceAnim()">W√úRFELN</button>
                        </div>
                        <div class="p-10 text-[#1aff1a] font-mono text-center opacity-80">> SYSTEM CHECK... OK<br>> LADE MODUL...</div>
                    </div>
                    <div id="log-panel">
                        <div class="bg-[#1aff1a] text-black font-bold px-2 flex justify-between items-center flex-shrink-0" style="box-shadow: 0 0 10px #1aff1a;"><h2>LOG</h2><span id="game-timer" class="font-mono text-sm">00:00:00</span></div>
                        <div id="log-area" class="flex-grow overflow-y-auto p-2 text-sm flex flex-col-reverse font-mono leading-relaxed text-green-400"></div>
                    </div>
                </div>
                <div class="px-4 pt-1 pb-1 text-center italic min-h-[1.5em] flex-shrink-0 bg-black border-t border-[#1aff1a] text-[#aaffaa]" id="encounter-text">...</div>
            </div>
        </div>
    </div>
</div>
<script>
    function loadScript(src) { return new Promise((resolve, reject) => { const s = document.createElement('script'); s.src = src; s.onload = resolve; s.onerror = reject; document.body.appendChild(s); }); }
    window.onload = function() {
        const verDisplay = document.getElementById('version-display');
        const loginVerDisplay = document.getElementById('login-version-display'); 
        fetch('Version?t=' + Date.now()).then(res => res.text()).then(v => {
            const ver = v.trim();
            if(verDisplay) { verDisplay.textContent = ver; verDisplay.classList.remove('animate-pulse'); }
            if(loginVerDisplay) { loginVerDisplay.textContent = ver; }
            console.log("Loading V:", ver);
            loadScript('network.js?v=' + ver).then(() => loadScript('ui.js?v=' + ver)).then(() => loadScript('game.js?v=' + ver)).then(() => {
                if(typeof UI !== 'undefined') UI.init();
                console.log("System bereit f√ºr Login.");
            });
        });
    };
</script>
</body>
</html>
