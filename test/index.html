<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pip-Boy 3003</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect width=%22100%22 height=%22100%22 rx=%2220%22 fill=%22%23000%22/><text x=%2250%25%22 y=%2250%25%22 font-size=%2280%22 font-family=%22monospace%22 font-weight=%22bold%22 fill=%22%231aff1a%22 dy=%22.35em%22 text-anchor=%22middle%22>P</text></svg>">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --pip-green: #1aff1a; --pip-glow: #2bff2b; --pip-dim: #0d330d; --pip-bg: #051105; }
        
        html, body { width: 100%; height: 100%; overflow: hidden; overscroll-behavior: none; position: fixed; background-color: #000; }
        body { color: var(--pip-green); font-family: 'VT323', monospace; display: flex; justify-content: center; align-items: center; user-select: none; -webkit-user-select: none; cursor: crosshair; }
        
        #view-container > * { max-width: 100%; overflow-x: hidden; }

        /* --- CRT TURN ON EFFECT --- */
        @keyframes turn-on {
            0% { transform: scale(1, 0.8) translate3d(0, 0, 0); filter: brightness(30); opacity: 1; }
            3.5% { transform: scale(1, 0.8) translate3d(0, 100%, 0); }
            3.6% { transform: scale(1, 0.8) translate3d(0, -100%, 0); opacity: 1; }
            9% { transform: scale(1.3, 0.6) translate3d(0, 100%, 0); filter: brightness(30); opacity: 0; }
            11% { transform: scale(2.4, 1) translate3d(0, 0, 0); filter: brightness(30); opacity: 0; }
            100% { transform: scale(1, 1) translate3d(0, 0, 0); filter: brightness(1); opacity: 1; }
        }
        .turn-on-anim { animation: turn-on 2.5s cubic-bezier(0.23, 1, 0.32, 1) forwards; }

        /* --- GLOBAL EFFECTS --- */
        .scanline {
            width: 100%; height: 100px; z-index: 9999;
            background: linear-gradient(0deg, rgba(0,0,0,0) 0%, rgba(26, 255, 26, 0.04) 50%, rgba(0,0,0,0) 100%);
            opacity: 0.1; position: absolute; bottom: 100%;
            animation: scanline 8s linear infinite; pointer-events: none;
        }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: -100%; } }

        .hex-bg {
            background-color: #000;
            background-image: 
                linear-gradient(rgba(26, 255, 26, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(26, 255, 26, 0.03) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: pan-grid 60s linear infinite;
        }
        @keyframes pan-grid { 0% { background-position: 0 0; } 100% { background-position: 100px 100px; } }

        .crt-flicker { animation: flicker 0.1s infinite; pointer-events: none; position: absolute; inset: 0; background: rgba(18, 16, 16, 0.1); z-index: 9000; mix-blend-mode: hard-light; opacity: 0.05; }
        @keyframes flicker { 0% { opacity: 0.05; } 50% { opacity: 0.08; } 100% { opacity: 0.05; } }

        /* TEXT STYLES */
        .glow-text { text-shadow: 0 0 5px var(--pip-glow), 0 0 10px var(--pip-glow); }
        
        /* UI ELEMENTS */
        .action-button { background-color: #0f1f0f; color: var(--pip-green); border: 1px solid var(--pip-green); padding: 5px 10px; margin: 2px; cursor: pointer; text-transform: uppercase; font-size: 1.25rem; transition: all 0.1s; font-family: 'VT323', monospace; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 5px var(--pip-dim); }
        .action-button:hover { background-color: var(--pip-green); color: black; box-shadow: 0 0 15px var(--pip-green); }
        .action-button:active { transform: scale(0.95); }
        .action-button:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(100%); pointer-events: none; border-color: #333; color: #555; }
        
        .header-btn { padding: 5px 15px; font-size: 1.25rem; display: flex; align-items: center; justify-content: center; border: 2px solid var(--pip-green); background: rgba(0, 20, 0, 0.8); color: var(--pip-green); text-transform: uppercase; font-weight: bold; min-width: 100px; transition: all 0.2s; }
        .header-btn:hover { background-color: var(--pip-green); color: black; }
        .header-btn:active { transform: scale(0.95); }
        .blink-red { animation: blink-red-anim 1s infinite; }
        @keyframes blink-red-anim { 0%, 100% { opacity: 1; color: red; } 50% { opacity: 0.5; } }
        
        .char-slot { border: 1px solid var(--pip-dim); background: rgba(0,20,0,0.5); padding: 10px; margin-bottom: 5px; cursor: pointer; transition: all 0.2s; display: flex; justify-content: space-between; align-items: center; }
        .char-slot:hover { border-color: var(--pip-green); background: rgba(0,40,0,0.8); }
        .char-slot.active-slot { border-color: var(--pip-green); background: var(--pip-green); color: black; font-weight: bold; }
        .char-slot.empty-slot { opacity: 0.5; font-style: italic; }

        .key-focus { outline: 2px solid var(--pip-green) !important; box-shadow: 0 0 15px var(--pip-green), inset 0 0 5px var(--pip-green) !important; background-color: rgba(57, 255, 20, 0.15) !important; z-index: 60; position: relative; animation: pulse-focus 1.5s infinite; }
        @keyframes pulse-focus { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }

        /* MINIGAME STYLES */
        .lock-container { position: relative; width: 250px; height: 250px; border-radius: 50%; border: 4px solid #333; background: radial-gradient(circle, #222, #000); box-shadow: inset 0 0 30px #000; margin: 0 auto; }
        .lock-inner { position: absolute; top: 10%; left: 10%; width: 80%; height: 80%; border-radius: 50%; border: 2px dashed #444; transition: transform 0.1s; }
        .lock-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: #111; border-radius: 50%; border: 1px solid #555; }
        .bobby-pin { position: absolute; top: 50%; left: 50%; width: 120px; height: 4px; background: silver; transform-origin: 0% 50%; transform: rotate(-90deg); transition: transform 0.05s; z-index: 20; border-radius: 2px; box-shadow: 0 0 5px black; }
        .screwdriver { position: absolute; bottom: 0; left: 50%; width: 20px; height: 100px; background: orange; transform: translateX(-50%); z-index: 10; opacity: 0.5; }
        .hack-row { font-family: 'VT323', monospace; letter-spacing: 2px; cursor: pointer; padding: 2px 5px; }
        .hack-row:hover, .hack-row.selected { background-color: var(--pip-green); color: black; font-weight: bold; }
        .hack-hex { color: #0d47a1; margin-right: 10px; }

        /* SCREENS & OVERLAYS */
        #login-screen, #spawn-screen, #reset-overlay, #manual-overlay, #changelog-overlay, #char-select-screen, #delete-confirm-overlay, #boot-screen { position: absolute; inset: 0; z-index: 999; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; height: 100%; }
        .login-box { border: 2px solid var(--pip-green); padding: 20px; text-align: center; box-shadow: 0 0 20px var(--pip-dim); width: 90%; max-width: 400px; display: flex; flex-direction: column; background: rgba(0, 10, 0, 0.9); z-index: 20; position: relative; }
        #login-form { width: 100%; display: flex; flex-direction: column; gap: 10px; margin-bottom: 10px; }
        input.login-input { background: #000; border: 2px solid var(--pip-green); color: var(--pip-green); font-family: inherit; font-size: 20px; padding: 10px; text-align: center; outline: none; width: 100%; box-shadow: inset 0 0 10px #002200; }
        input.login-input::placeholder { color: rgba(26, 255, 26, 0.5); }
        input.login-input:focus { box-shadow: inset 0 0 15px #004400, 0 0 10px var(--pip-green); }

        /* BOOT SCREEN CENTERED */
        #boot-screen { align-items: center; justify-content: center; padding: 20px; font-family: 'VT323', monospace; color: var(--pip-green); font-size: 1.2rem; line-height: 1.2; overflow: hidden; z-index: 2000; display: flex; flex-direction: column; background: black; text-align: center; }
        #boot-content { max-width: 600px; width: 100%; display: flex; flex-direction: column; alignItems: center; }
        .boot-cursor { display: inline-block; width: 10px; height: 1.2em; background: var(--pip-green); animation: blink 0.8s infinite; vertical-align: bottom; margin-left: 5px; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* LAYOUTS */
        #pipboy-case { background: linear-gradient(145deg, #1a1a1a, #0d0d0d); padding: 10px; border-radius: 20px; box-shadow: inset 0 0 20px #000, 0 0 0 5px #2a2a2a, 0 0 30px rgba(0,0,0,0.8); width: 100%; max-width: 1200px; height: 100vh; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        @media (min-width: 768px) { #pipboy-case { height: 95vh; padding: 15px; border-radius: 30px; } }
        
        #game-screen { background-color: var(--pip-bg); border: 2px solid var(--pip-dim); border-radius: 10px; flex-grow: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; width: 100%; }
        .crt-overlay { background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 2px, 3px 100%; position: absolute; inset: 0; pointer-events: none; z-index: 5000; }

        #main-content { flex-grow: 1; display: flex; overflow: hidden; min-height: 0; position: relative; width: 100%; }
        #main-panel { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; min-height: 0; width: 100%; }
        #layout-split { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; min-height: 0; width: 100%; }
        #view-container { position: relative; flex-grow: 0; flex-shrink: 0; display: flex; justify-content: center; align-items: center; height: 70%; border-bottom: 2px solid var(--pip-green); overflow: hidden; width: 100%; }
        #log-panel { display: flex; flex-direction: column; flex-shrink: 0; flex-grow: 1; height: 30%; min-height: 0; background-color: #020a02; width: 100%; }
        
        @media (min-width: 768px) { 
            #layout-split { flex-direction: row; }
            #view-container { width: 75%; height: 100%; border-bottom: none; border-right: 2px solid var(--pip-green); flex-grow: 1; }
            #log-panel { width: 25%; height: 100%; border-left: none; }
        }
    </style>
    <script>window.onerror=function(m,u,l){console.error("ERR:",m);if(typeof UI!=='undefined'&&UI.error)UI.error(m);return false;};</script>
</head>
<body class="turn-on-anim">
<div id="pipboy-case">
    <div class="scanline"></div>
    <div class="crt-flicker"></div>
    <div class="crt-overlay"></div>

    <div id="boot-screen">
        <div id="boot-anim-area" class="font-bold text-yellow-400 mb-4 whitespace-pre text-center leading-none" style="font-size: 10px; md:font-size: 14px;"></div>
        <div id="boot-content"></div>
        <span class="boot-cursor"></span>
    </div>

    <div id="login-screen" class="hex-bg" style="display: none;">
        <div class="login-box crt-effect-container" style="box-shadow: 0 0 50px rgba(26,255,26,0.2);">
            <h1 class="text-5xl md:text-6xl font-bold glow-text mb-2">PIP-BOY 3003</h1>
            <div id="login-title" class="text-xl mb-4 opacity-80 animate-pulse tracking-widest">AUTHENTICATION REQUIRED</div>
            <form id="login-form" onsubmit="event.preventDefault();" autocomplete="off">
                <input type="email" id="login-email" class="login-input" placeholder="E-MAIL" autofocus autocomplete="username">
                <input type="password" id="login-pass" class="login-input" placeholder="PASSWORT" autocomplete="current-password">
                <input type="text" id="login-name" class="login-input hidden" placeholder="ACCOUNT NAME" maxlength="15" autocomplete="off" style="display: none;">
            </form>
            <button id="btn-login" class="action-button w-full py-3 font-bold text-xl mb-2">LOGIN</button>
            <button id="btn-toggle-register" class="text-sm text-yellow-400 hover:text-yellow-200 cursor-pointer mb-4 underline bg-transparent border-none">Noch kein Account? Hier registrieren</button>
            <div class="flex gap-2 w-full">
                <button id="btn-manual-login" class="action-button flex-1 py-2 font-bold text-lg border-yellow-400 text-yellow-400" onclick="UI.showManualOverlay()">ANLEITUNG</button>
                <button id="btn-changelog" class="action-button flex-1 py-2 font-bold text-lg border-blue-400 text-blue-400" onclick="UI.showChangelogOverlay()">CHANGELOG</button>
            </div>
            <div id="login-status" class="mt-4 text-yellow-400 min-h-[1.5em] text-sm font-mono break-words"></div>
            <div class="mt-4 text-xs text-[#1aff1a] opacity-50 border-t border-[#1aff1a]/30 pt-2 w-full">VERSION <span id="login-version-display">LOADING...</span></div>
        </div>
    </div>

    <div id="char-select-screen" style="display: none;">
        <div class="login-box crt-effect-container w-full max-w-lg">
            <h1 class="text-4xl font-bold text-yellow-400 mb-4 border-b border-yellow-400 pb-2">CHARAKTER WAHL</h1>
            <div class="text-xs mb-4 text-green-300">W√§hle einen Slot.</div>
            <div id="char-slots-list" class="flex flex-col gap-2 w-full mb-4"></div>
            <div class="flex flex-col gap-2 w-full mb-4">
                <button id="btn-char-select-action" class="action-button w-full font-bold border-yellow-400 text-yellow-400 py-3">CHARAKTER ERSTELLEN</button>
                <button id="btn-char-delete-action" class="action-button w-full font-bold border-red-500 text-red-500 py-2 hidden">CHARAKTER L√ñSCHEN</button>
            </div>
            <button class="action-button w-full border-gray-500 text-gray-500" onclick="UI.logout('LOGOUT')">ABMELDEN</button>
        </div>
    </div>

    <div id="delete-confirm-overlay" style="display: none;">
        <div class="login-box crt-effect-container border-red-500" style="box-shadow: 0 0 30px red;">
            <h2 class="text-3xl font-bold text-red-600 mb-2">WARNUNG</h2>
            <p class="text-red-400 mb-4">Charakter unwiderruflich l√∂schen?<br>Tippe den Namen zur Best√§tigung:</p>
            <div id="delete-target-name" class="font-bold text-white mb-2 text-xl bg-red-900/50 p-2 border border-red-500">???</div>
            <input type="text" id="delete-input" class="login-input border-red-500 text-red-500 mb-4" placeholder="NAME EINGEBEN" autocomplete="off">
            <div class="flex gap-2 w-full">
                <button id="btn-delete-confirm" class="action-button flex-1 border-red-500 text-red-500 font-bold" disabled>L√ñSCHEN</button>
                <button id="btn-delete-cancel" class="action-button flex-1 border-green-500 text-green-500">ABBRECHEN</button>
            </div>
        </div>
    </div>
    
    <div id="new-char-overlay" class="absolute inset-0 z-[1000] bg-black/95 flex flex-col justify-center items-center hidden">
        <div class="login-box crt-effect-container border-yellow-400">
            <h2 class="text-3xl font-bold text-yellow-400 mb-2">NEUE IDERNTIT√ÑT</h2>
            <p class="text-green-300 mb-4">Wie soll dein neuer Charakter hei√üen?</p>
            <input type="text" id="new-char-name" class="login-input mb-4 text-yellow-400 border-yellow-400" placeholder="NAME" maxlength="15">
            <div class="flex gap-2 w-full">
                <button id="btn-create-char" class="action-button flex-1 border-yellow-400 text-yellow-400 font-bold">ERSTELLEN</button>
                <button onclick="document.getElementById('new-char-overlay').classList.add('hidden')" class="action-button flex-1">ABBRUCH</button>
            </div>
        </div>
    </div>

    <div id="manual-overlay" class="hidden z-[1000] bg-black/95" style="display: none;"><div class="border-2 border-yellow-400 w-full max-w-2xl h-[90vh] bg-[#111] flex flex-col p-4 shadow-[0_0_30px_#aa0]"><div class="flex justify-between items-center border-b border-yellow-400 pb-2 mb-2"><h2 class="text-2xl font-bold text-yellow-400">HANDBUCH v1.0</h2><button class="text-red-500 font-bold text-xl px-2 border border-red-500 hover:bg-red-900" onclick="document.getElementById('manual-overlay').classList.add('hidden'); document.getElementById('manual-overlay').style.display='none';">X</button></div><div id="manual-content" class="flex-grow overflow-y-auto text-green-300 font-mono space-y-4 pr-2"></div></div></div>
    <div id="changelog-overlay" class="hidden z-[1000] bg-black/95" style="display: none;"><div class="border-2 border-blue-400 w-full max-w-2xl h-[90vh] bg-[#050510] flex flex-col p-4 shadow-[0_0_30px_#00a]"><div class="flex justify-between items-center border-b border-blue-400 pb-2 mb-2"><h2 class="text-2xl font-bold text-blue-400">PATCH NOTES</h2><button class="text-red-500 font-bold text-xl px-2 border border-red-500 hover:bg-red-900" onclick="document.getElementById('changelog-overlay').classList.add('hidden'); document.getElementById('changelog-overlay').style.display='none';">X</button></div><div id="changelog-content" class="flex-grow overflow-y-auto text-blue-200 font-mono text-sm leading-relaxed whitespace-pre-wrap pr-2"></div></div></div>
    <div id="spawn-screen" style="display: none;"><div class="login-box crt-effect-container"><h1 class="text-3xl md:text-4xl font-bold glow-text mb-4">NEUER CHARAKTER</h1><div id="spawn-msg" class="text-sm mb-4 text-red-400 font-bold"></div><div id="spawn-list" class="flex flex-col gap-2 max-h-[250px] overflow-y-auto mb-4 border border-green-900 p-2 text-left"></div><button id="btn-spawn-random" class="action-button w-full mb-2">ZUFALLS-START</button><button class="action-button w-full border-red-500 text-red-500" onclick="location.reload()">ABBRUCH</button></div></div>
    <div id="reset-overlay" style="display: none;"><div class="login-box crt-effect-container border-red-500" style="box-shadow: 0 0 20px #500;"><h1 class="text-4xl font-bold text-red-500 mb-4 animate-pulse">ACHTUNG!</h1><div class="text-lg mb-8 text-red-400 font-bold">CHARAKTER L√ñSCHEN?<br>ALLES GEHT VERLOREN!</div><div class="flex flex-col gap-2 w-full"><button id="btn-confirm-reset" class="action-button w-full border-red-500 text-red-500 font-bold hover:bg-red-900">JA, L√ñSCHEN</button><button id="btn-cancel-reset" class="action-button w-full border-green-500 text-green-500">ABBRECHEN</button></div></div></div>
    <div id="game-over-screen" class="absolute inset-0 z-50 bg-black/95 flex flex-col justify-center items-center hidden"><h1 class="text-6xl text-red-600 font-bold border-4 border-red-600 p-6 mb-6 blink-red tracking-widest">CRITICAL FAILURE</h1><button id="btn-restart" onclick="location.reload()" class="border-2 border-red-500 text-red-500 px-8 py-3 hover:bg-red-900 text-xl font-bold uppercase cursor-pointer">NEUSTART</button></div>
    <div id="player-list-overlay"><div class="font-bold border-b border-green-500 mb-2 pb-1 text-center">SIGNALE</div><div id="player-list-content" class="text-sm space-y-1"></div><button class="action-button w-full mt-2 text-xs" onclick="UI.togglePlayerList()">SCHLIESSEN</button></div>

    <div id="game-screen" class="hidden opacity-0 transition-opacity duration-1000">
        <header class="flex items-center justify-between p-2 border-b-2 border-[#39ff14] bg-[#001100] z-30 h-20 shrink-0 relative gap-2 w-full">
            <div class="flex flex-col justify-center h-full min-w-0 flex-grow leading-tight gap-1">
                <div class="flex items-baseline gap-2">
                    <span id="val-name" class="text-xl font-bold text-cyan-400 uppercase tracking-wide truncate">PLAYER</span>
                    <span class="text-yellow-400 font-bold text-sm">LVL <span id="val-lvl">1</span></span>
                    <span class="text-yellow-400 font-bold text-sm ml-2"> <span id="val-caps" class="text-yellow-400 text-lg">0</span> KK</span>
                </div>
                <div class="flex items-center gap-2 w-full max-w-xs">
                    <span class="text-xs font-bold w-6">HP</span>
                    <div class="flex-grow h-3 bg-gray-900 border border-[#39ff14] relative">
                        <div id="bar-hp" class="absolute top-0 left-0 h-full bg-[#1aff1a] transition-all duration-300" style="width: 100%"></div>
                        <div id="val-hp" class="absolute inset-0 text-[10px] flex items-center justify-center text-black font-bold leading-none" style="text-shadow: none;">100/100</div>
                    </div>
                </div>
                <div class="flex items-center gap-2 w-full max-w-xs">
                    <span class="text-xs font-bold w-6 text-yellow-400">XP</span>
                    <div class="flex-grow h-3 bg-gray-900 border border-yellow-500 relative">
                        <div id="bar-exp-top" class="absolute top-0 left-0 h-full bg-yellow-500 transition-all duration-300" style="width: 0%"></div>
                        <div class="absolute inset-0 text-[10px] flex items-center justify-center text-black font-bold leading-none" style="text-shadow: none;"><span id="val-xp-txt">0</span>%</div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row items-center gap-2 shrink-0">
                <button id="btn-save" class="header-btn border-yellow-400 text-yellow-400 hover:bg-yellow-900 hidden md:flex" title="Speichern">SPEICHERN</button>
                <button id="btn-menu-toggle" class="header-btn border-[#39ff14]" title="Men√º">MEN√ú</button>
            </div>
            <div id="main-nav" class="hidden absolute top-20 right-0 z-[100] flex-col bg-black border-2 border-[#39ff14] p-2 gap-2 shadow-[0_5px_15px_#000] w-56">
                <button id="btn-inv" class="action-button w-full text-left">INVENTAR</button>
                <button id="btn-char" class="action-button w-full text-left">CHARAKTER</button>
                <button id="btn-map" class="action-button w-full text-left">WELT</button>
                <button id="btn-quests" class="action-button w-full text-left">AUFGABEN</button>
                <button id="btn-wiki" class="action-button w-full text-left">WIKI</button>
                <button id="btn-manual-game" class="action-button w-full text-left text-yellow-400 border-yellow-400" onclick="UI.showManualOverlay()">HANDBUCH</button>
                <div class="border-t border-green-900 my-1"></div>
                <button id="btn-menu-save" class="action-button w-full text-left border-yellow-400 text-yellow-400">SPEICHERN</button>
                <button id="btn-logout" class="action-button w-full text-left text-red-400 border-red-500">LOGOUT</button>
                <div class="text-[10px] text-center text-white opacity-80 mt-1"><span id="val-players">?</span> USER | v<span id="version-display">...</span></div>
            </div>
        </header>
        <div id="main-content">
            <div id="main-panel">
                <div id="layout-split">
                    <div id="view-container" class="crt-effect-container">
                        <button id="btn-toggle-dpad" class="hidden">üéÆ</button>
                        <div id="overlay-controls"></div>
                        <div id="dialog-overlay"></div>
                        <div id="dice-overlay" class="hidden"></div>
                    </div>
                    <div id="log-panel">
                        <div class="bg-[#1aff1a] text-black font-bold px-2 flex justify-between items-center flex-shrink-0" style="box-shadow: 0 0 10px #1aff1a;"><h2>LOG</h2><span id="game-timer" class="font-mono text-sm">00:00:00</span></div>
                        <div id="log-area" class="flex-grow overflow-y-auto p-2 text-sm flex flex-col-reverse font-mono leading-relaxed text-green-400 cursor-pointer"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    function loadScript(src) { return new Promise((resolve, reject) => { const s = document.createElement('script'); s.src = src; s.onload = resolve; s.onerror = reject; document.body.appendChild(s); }); }
    
    // TYPEWRITER UTILS
    async function typeWriter(text, element, speed = 30) {
        if (!text) return;
        const line = document.createElement('div');
        element.appendChild(line);
        for (let i = 0; i < text.length; i++) {
            line.textContent += text.charAt(i);
            await new Promise(r => setTimeout(r, speed));
        }
        return new Promise(r => setTimeout(r, 100)); // Pause after line
    }

    // ANIMATED BOOT SEQUENCE
    async function runBootSequence() {
        const animArea = document.getElementById('boot-anim-area');
        const content = document.getElementById('boot-content');
        
        await new Promise(r => setTimeout(r, 800)); // Wait for CRT warm up

        // ASCII ART FRAMES (Little Man & Vault Door)
        const frames = [
`
   O      [‚öôÔ∏è]
  /|\\     | |
  / \\     |_|
`,
`
   O      [‚öôÔ∏è]
  \\|/    /   \\
  / \\    \\___/
`,
`
  \\O/     [‚öôÔ∏è]
   |      | |
  / \\     |_|
`
        ];

        // Animate Frames
        for (let i=0; i<15; i++) {
            animArea.textContent = frames[i % frames.length];
            await new Promise(r => setTimeout(r, 200));
        }
        
        // Static final frame
        animArea.textContent = `
   O      [OK]
  /|\\    VAULT
  / \\    OPEN
`;

        await typeWriter("ROBCO INDUSTRIES (TM) TERMLINK PROTOCOL", content, 20);
        await typeWriter("> CONNECTING TO VAULT 1337 NETWORK...", content, 20);
        await typeWriter("> VERIFYING BIO-METRICS... [OK]", content, 15);
        await typeWriter("> MEMORY CHECK: 64KB OK", content, 10);
        await typeWriter("> SYSTEM INITALIZED.", content, 20);
        await typeWriter("WELCOME HOME.", content, 100);
        
        // Blink effect before switch
        await new Promise(r => setTimeout(r, 800));
        document.body.classList.add('turn-off-anim'); // Optional fade out if we had one
        
        document.getElementById('boot-screen').style.display = 'none';
        document.getElementById('login-screen').style.display = 'flex';
    }

    window.onload = function() {
        runBootSequence();

        const verDisplay = document.getElementById('version-display');
        const loginVerDisplay = document.getElementById('login-version-display'); 
        fetch('Version?t=' + Date.now()).then(res => res.text()).then(v => {
            const ver = v.trim();
            if(verDisplay) { verDisplay.textContent = ver; verDisplay.classList.remove('animate-pulse'); }
            if(loginVerDisplay) { loginVerDisplay.textContent = ver; }
            console.log("Loading V:", ver);
            loadScript('data.js?v=' + ver)
                .then(() => loadScript('world_gen.js?v=' + ver))
                .then(() => loadScript('network.js?v=' + ver))
                .then(() => loadScript('minigames.js?v=' + ver))
                .then(() => loadScript('combat.js?v=' + ver))
                .then(() => loadScript('game.js?v=' + ver))
                .then(() => loadScript('ui_core.js?v=' + ver))
                .then(() => loadScript('ui_render.js?v=' + ver))
                .then(() => loadScript('ui_input.js?v=' + ver))
                .then(() => { if(typeof UI !== 'undefined') UI.init(); console.log("System Ready."); });
        });
    };
</script>
</body>
</html>
