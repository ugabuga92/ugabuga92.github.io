<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pip-Boy 3003</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --pip-green: #1aff1a; --pip-glow: #2bff2b; --pip-dim: #0d330d; --pip-bg: #051105; }
        html, body { width: 100%; height: 100%; overflow: hidden; overscroll-behavior: none; position: fixed; background-color: #000; color: var(--pip-green); font-family: 'VT323', monospace; user-select: none; -webkit-user-select: none; cursor: crosshair; }
        #view-container > * { max-width: 100%; overflow-x: hidden; }
        
        /* LAYOUT & GLOWS */
        .key-focus { outline: 2px solid var(--pip-green) !important; box-shadow: 0 0 15px var(--pip-green) !important; background-color: rgba(57, 255, 20, 0.15) !important; animation: pulse 1.5s infinite; }
        .alert-glow-red { animation: blink-red 1s infinite; color: red; border-color: red; box-shadow: 0 0 10px red; }
        .alert-glow-yellow { animation: pulse 2s infinite; color: yellow; border-color: yellow; }
        .alert-glow-cyan { animation: pulse 2s infinite; color: cyan; border-color: cyan; }
        @keyframes pulse { 50% { opacity: 0.7; box-shadow: 0 0 20px currentColor; } }
        @keyframes blink-red { 50% { opacity: 0.5; } }
        
        .char-slot { border: 1px solid var(--pip-dim); background: rgba(0,20,0,0.5); padding: 10px; margin-bottom: 5px; cursor: pointer; display: flex; justify-content: space-between; }
        .char-slot.active-slot { border-color: var(--pip-green); background: var(--pip-green); color: black; font-weight: bold; }
        .char-slot.empty-slot { opacity: 0.5; font-style: italic; }

        /* SCROLLBAR & CRT */
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-thumb { background: var(--pip-dim); border: 1px solid var(--pip-green); }
        .crt-effect-container::before { content: " "; display: block; position: absolute; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.15) 50%), linear-gradient(90deg, rgba(255,0,0,0.03), rgba(0,255,0,0.01), rgba(0,0,255,0.03)); z-index: 10; background-size: 100% 3px, 4px 100%; pointer-events: none; }

        .action-button { background: #0f1f0f; color: var(--pip-green); border: 1px solid var(--pip-green); padding: 5px; margin: 2px; cursor: pointer; text-transform: uppercase; font-size: 1.25rem; display: flex; justify-content: center; align-items: center; }
        .action-button:hover { background: var(--pip-green); color: black; }
        .header-btn { padding: 5px 15px; border: 2px solid var(--pip-green); background: rgba(0, 20, 0, 0.8); color: var(--pip-green); font-weight: bold; }
        .header-btn:hover { background: var(--pip-green); color: black; }

        /* SCREENS */
        #login-screen, #char-select-screen, #spawn-screen, #reset-overlay, #manual-overlay, #changelog-overlay, #delete-confirm-overlay, #game-over-screen { position: absolute; inset: 0; z-index: 999; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .login-box { border: 2px solid var(--pip-green); padding: 20px; text-align: center; box-shadow: 0 0 20px var(--pip-dim); width: 90%; max-width: 400px; }
        input.login-input { background: #000; border: 2px solid var(--pip-green); color: var(--pip-green); font-family: inherit; font-size: 20px; padding: 10px; text-align: center; width: 100%; outline: none; }
        
        /* LAYOUT */
        #pipboy-case { background: #111; padding: 10px; height: 100vh; display: flex; flex-direction: column; }
        #game-screen { background: var(--pip-bg); border: 2px solid var(--pip-dim); flex-grow: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
        #main-content { flex-grow: 1; display: flex; overflow: hidden; position: relative; }
        #main-panel { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        #layout-split { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        
        /* MOBILE OPTIMIZED RATIOS */
        #view-container { flex-grow: 0; flex-shrink: 0; height: 70%; border-bottom: 2px solid var(--pip-green); position: relative; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        #log-panel { flex-grow: 1; height: 30%; background: #020a02; display: flex; flex-direction: column; min-height: 0; }
        
        @media (min-width: 768px) { 
            #pipboy-case { padding: 20px; height: 95vh; margin: 2vh auto; max-width: 1200px; border-radius: 30px; box-shadow: 0 0 50px #000; }
            #layout-split { flex-direction: row; }
            #view-container { width: 75%; height: 100%; border-bottom: none; border-right: 2px solid var(--pip-green); flex-grow: 1; }
            #log-panel { width: 25%; height: 100%; }
        }
    </style>
</head>
<body>
<div id="pipboy-case">
    <div id="login-screen">
        <div class="login-box crt-effect-container">
            <h1 class="text-5xl font-bold mb-2" style="text-shadow: 0 0 10px #2bff2b;">PIP-BOY 3003</h1>
            <div class="text-xl mb-4 opacity-80">AUTHENTICATION REQUIRED</div>
            <form onsubmit="event.preventDefault();" class="flex flex-col gap-2 mb-4">
                <input type="email" id="login-email" class="login-input" placeholder="E-MAIL" autocomplete="username">
                <input type="password" id="login-pass" class="login-input" placeholder="PASSWORT" autocomplete="current-password">
                <input type="text" id="login-name" class="login-input hidden" placeholder="ACCOUNT NAME" style="display:none;">
            </form>
            <button id="btn-login" class="action-button w-full py-3 font-bold text-xl mb-2">LOGIN</button>
            <button id="btn-toggle-register" class="text-sm text-yellow-400 hover:text-yellow-200 underline bg-transparent border-none">Noch kein Account? Hier registrieren</button>
            <div class="flex gap-2 w-full mt-4">
                <button onclick="UI.showManualOverlay()" class="action-button flex-1 border-yellow-400 text-yellow-400">ANLEITUNG</button>
                <button onclick="UI.showChangelogOverlay()" class="action-button flex-1 border-blue-400 text-blue-400">CHANGELOG</button>
            </div>
            <div id="login-status" class="mt-4 text-yellow-400 text-sm font-mono"></div>
            <div class="mt-2 text-xs opacity-50">VERSION <span id="login-version-display">LOADING...</span></div>
        </div>
    </div>

    <div id="char-select-screen" style="display: none;">
        <div class="login-box crt-effect-container w-full max-w-lg">
            <h1 class="text-4xl font-bold text-yellow-400 mb-4 border-b border-yellow-400 pb-2">CHARAKTER WAHL</h1>
            <div class="text-xs mb-4 text-green-300">Wähle einen Slot.</div>
            <div id="char-slots-list" class="flex flex-col gap-2 w-full mb-4"></div>
            <div class="flex flex-col gap-2 w-full mb-4">
                <button id="btn-char-select-action" class="action-button w-full font-bold border-yellow-400 text-yellow-400 py-3">LADE...</button>
                <button id="btn-char-delete-action" class="action-button w-full font-bold border-red-500 text-red-500 py-2 hidden" style="display:none;">CHARAKTER LÖSCHEN</button>
            </div>
            <button class="action-button w-full border-gray-500 text-gray-500" onclick="UI.logout('LOGOUT')">ABMELDEN</button>
        </div>
    </div>

    <div id="new-char-overlay" class="hidden z-[1000] bg-black/95 flex flex-col justify-center items-center absolute inset-0">
        <div class="login-box crt-effect-container border-yellow-400">
            <h2 class="text-3xl font-bold text-yellow-400 mb-2">NEUE IDENTITÄT</h2>
            <p class="text-green-300 mb-4">Wie soll dein Charakter heißen?</p>
            <input type="text" id="new-char-name" class="login-input mb-4 text-yellow-400 border-yellow-400" placeholder="NAME" maxlength="15">
            <div class="flex gap-2 w-full">
                <button id="btn-create-char-confirm" class="action-button flex-1 border-yellow-400 text-yellow-400 font-bold">ERSTELLEN</button>
                <button onclick="document.getElementById('new-char-overlay').classList.add('hidden')" class="action-button flex-1">ABBRUCH</button>
            </div>
        </div>
    </div>

    <div id="delete-confirm-overlay" style="display: none;">
        <div class="login-box crt-effect-container border-red-500" style="box-shadow: 0 0 30px red;">
            <h2 class="text-3xl font-bold text-red-600 mb-2">WARNUNG</h2>
            <p class="text-red-400 mb-4">Wirklich löschen?<br>Tippe den Namen zur Bestätigung:</p>
            <div id="delete-target-name" class="font-bold text-white mb-2 text-xl bg-red-900/50 p-2 border border-red-500">???</div>
            <input type="text" id="delete-input" class="login-input border-red-500 text-red-500 mb-4" placeholder="NAME" autocomplete="off">
            <div class="flex gap-2 w-full">
                <button id="btn-delete-confirm" class="action-button flex-1 border-red-500 text-red-500 font-bold" disabled>LÖSCHEN</button>
                <button id="btn-delete-cancel" class="action-button flex-1 border-green-500 text-green-500">ABBRECHEN</button>
            </div>
        </div>
    </div>

    <div id="game-screen" class="hidden opacity-0 transition-opacity duration-1000">
        <header class="flex items-center justify-between p-2 border-b-2 border-[#39ff14] bg-[#001100] z-30 h-16 shrink-0 relative gap-2 w-full">
            <div class="flex flex-col justify-center h-full flex-grow leading-tight">
                <div class="flex items-baseline gap-2">
                    <span id="val-name" class="text-xl font-bold text-cyan-400 uppercase truncate">PLAYER</span>
                    <span class="text-yellow-400 text-sm font-bold">LVL <span id="val-lvl">1</span></span>
                    <span class="text-yellow-400 text-sm font-bold ml-2"><span id="val-caps">0</span> KK</span>
                </div>
                <div class="flex items-center gap-2 w-full max-w-xs h-3 bg-gray-900 border border-[#39ff14] relative">
                    <div id="bar-hp" class="absolute h-full bg-[#1aff1a] transition-all" style="width: 100%"></div>
                    <div id="val-hp" class="absolute inset-0 text-[10px] flex items-center justify-center text-black font-bold">100/100</div>
                </div>
            </div>
            <div class="flex items-center gap-2">
                <button id="btn-save" class="header-btn hidden md:flex">SPEICHERN</button>
                <button id="btn-menu-toggle" class="header-btn">MENÜ</button>
            </div>
            <div id="main-nav" class="hidden absolute top-16 right-0 z-[100] flex-col bg-black border-2 border-[#39ff14] p-2 gap-2 w-56 shadow-[0_5px_15px_#000]">
                <button id="btn-inv" class="action-button w-full text-left">INVENTAR</button>
                <button id="btn-char" class="action-button w-full text-left">CHARAKTER</button>
                <button id="btn-map" class="action-button w-full text-left">WELT</button>
                <button id="btn-quests" class="action-button w-full text-left">AUFGABEN</button>
                <button id="btn-wiki" class="action-button w-full text-left">WIKI</button>
                <button onclick="UI.showManualOverlay()" class="action-button w-full text-left text-yellow-400 border-yellow-400">HANDBUCH</button>
                <div class="border-t border-green-900 my-1"></div>
                <button id="btn-menu-save" class="action-button w-full text-left border-yellow-400 text-yellow-400">SPEICHERN</button>
                <button id="btn-logout" class="action-button w-full text-left text-red-400 border-red-500">LOGOUT</button>
                <div class="text-[10px] text-center opacity-80"><span id="val-players">?</span> USER</div>
            </div>
        </header>

        <div id="main-content">
            <div id="main-panel">
                <div id="layout-split">
                    <div id="view-container" class="crt-effect-container">
                        <div id="overlay-controls"></div>
                        <div id="dialog-overlay"></div>
                    </div>
                    <div id="log-panel">
                        <div class="bg-[#1aff1a] text-black font-bold px-2 flex justify-between items-center"><h2>LOG</h2><span id="game-timer">00:00:00</span></div>
                        <div id="log-area" class="flex-grow overflow-y-auto p-2 text-sm flex flex-col-reverse font-mono leading-relaxed text-green-400"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="manual-overlay" class="hidden z-[1000] bg-black/95">
        <div class="border-2 border-yellow-400 w-full max-w-2xl h-[90vh] bg-[#111] flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-yellow-400 pb-2"><h2 class="text-2xl text-yellow-400">HANDBUCH</h2><button class="text-red-500 font-bold px-2 border border-red-500" onclick="this.parentElement.parentElement.parentElement.style.display='none'">X</button></div>
            <div id="manual-content" class="flex-grow overflow-y-auto text-green-300 p-2"></div>
        </div>
    </div>
    <div id="changelog-overlay" class="hidden z-[1000] bg-black/95">
         <div class="border-2 border-blue-400 w-full max-w-2xl h-[90vh] bg-[#050510] flex flex-col p-4">
            <div class="flex justify-between items-center border-b border-blue-400 pb-2"><h2 class="text-2xl text-blue-400">CHANGELOG</h2><button class="text-red-500 font-bold px-2 border border-red-500" onclick="this.parentElement.parentElement.parentElement.style.display='none'">X</button></div>
            <div id="changelog-content" class="flex-grow overflow-y-auto text-blue-200 p-2 whitespace-pre-wrap"></div>
        </div>
    </div>
    <div id="game-over-screen" class="absolute inset-0 z-50 bg-black/95 flex flex-col justify-center items-center hidden"><h1 class="text-6xl text-red-600 font-bold border-4 border-red-600 p-6 mb-6 blink-red">CRITICAL FAILURE</h1><button onclick="location.reload()" class="border-2 border-red-500 text-red-500 px-8 py-3 text-xl font-bold uppercase">NEUSTART</button></div>
    <div id="spawn-screen" style="display: none;"><div class="login-box"><div id="spawn-list"></div><button id="btn-spawn-random">ZUFALL</button></div></div>
    <div id="reset-overlay" style="display: none;"><div class="login-box border-red-500"><h1 class="text-red-500">RESET?</h1><button id="btn-confirm-reset" class="border-red-500 text-red-500">JA</button><button id="btn-cancel-reset">NEIN</button></div></div>
    <div id="player-list-overlay"></div>
</div>

<script>
    function loadScript(src) { return new Promise((resolve, reject) => { const s = document.createElement('script'); s.src = src; s.onload = resolve; s.onerror = reject; document.body.appendChild(s); }); }
    window.onload = function() {
        const ver = Date.now(); // Cache Buster
        const vDisplay = document.getElementById('login-version-display');
        fetch('Version?t='+ver).then(r=>r.text()).then(v=>{ if(vDisplay) vDisplay.textContent=v.trim(); 
            // MODULAR LOADER
            loadScript('data.js?v='+ver)
            .then(() => loadScript('world_gen.js?v='+ver))
            .then(() => loadScript('network.js?v='+ver))
            .then(() => loadScript('ui_core.js?v='+ver))   // TEIL 1
            .then(() => loadScript('ui_render.js?v='+ver)) // TEIL 2
            .then(() => loadScript('ui_input.js?v='+ver))  // TEIL 3
            .then(() => loadScript('combat.js?v='+ver))
            .then(() => loadScript('game.js?v='+ver))
            .then(() => { if(typeof UI!=='undefined') UI.init(); console.log("System Ready."); })
            .catch(e => console.error("LOAD ERROR:", e));
        });
    };
</script>
</body>
</html>
