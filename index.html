<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pip-Boy 3000 Mk-V - RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* --- PIP-BOY CORE STYLES --- */
        :root {
            --pip-green: #39ff14; 
            --pip-dim: #1a4d1a;
            --pip-dark: #0a0f0a;
            --pip-bg: #050505;
            --pip-shadow: 0 0 10px rgba(57, 255, 20, 0.4);
            
            /* Wasteland Map Colors */
            --color-arid: #4a3d34; 
            --color-path: #8b7d6b; 
            --color-rock: #5c544d; 
            --color-water: #224f80; 
            --color-city: #7a661f; 
            --color-fog: #000000;
        }

        body {
            background-color: #000;
            color: var(--pip-green);
            font-family: 'VT323', monospace;
            display: flex;
            justify-content: center;
            align-items: center; 
            min-height: 100vh;
            padding: 0; 
            margin: 0;
            overflow: hidden; 
            user-select: none;
        }

        #pipboy-case {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 20px;
            box-shadow: inset 0 0 20px #000, 0 0 15px #333;
            width: 100%;
            max-width: 1200px;
            height: 98vh; 
            display: flex;
            flex-direction: column;
            transition: transform 0.05s ease-in-out; 
        }
        
        .screen-shake {
            animation: shake 0.2s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        #game-screen {
            background-color: var(--pip-dark);
            border: 2px solid var(--pip-green);
            box-shadow: inset 0 0 20px rgba(57, 255, 20, 0.1);
            border-radius: 10px;
            width: 100%;
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }
        
        .damage-flash {
            animation: flash-red 0.1s;
        }

        @keyframes flash-red {
            0% { box-shadow: inset 0 0 30px rgba(255, 0, 0, 0.5); }
            100% { box-shadow: inset 0 0 20px rgba(57, 255, 20, 0.1); }
        }

        #game-screen::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 50;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }
        
        #system-status-bar {
            border-bottom: 2px solid var(--pip-green);
            padding: 0.5rem 1rem;
            background: rgba(57, 255, 20, 0.05); 
            flex-shrink: 0;
        }

        #view-content-area {
            width: 100%;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--pip-bg);
            border-bottom: 2px solid var(--pip-green); 
            position: relative;
            overflow: hidden;
        }
        
        .view {
            width: 100%;
            height: 100%;
            display: none; /* Wichtig: Standardmäßig versteckt */
            position: absolute;
            top: 0;
            left: 0;
            transition: opacity 0.3s, transform 0.3s, filter 0.3s;
        }
        
        .view.active {
            display: flex; /* Nur die aktive View anzeigen */
        }
        
        .view.transition-out {
            opacity: 0;
            transform: scale(1.05);
            filter: blur(5px);
        }

        .header-bar {
            display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 1rem;
            border-bottom: 2px solid var(--pip-green); background: rgba(57, 255, 20, 0.05); flex-shrink: 0;
        }
        .section-header {
            color: #000; background-color: var(--pip-green); font-size: 1.1rem; text-transform: uppercase;
            padding: 1px 6px; margin-bottom: 2px; font-weight: bold; letter-spacing: 1px; display: inline-block;
        }
        .pip-text { color: var(--pip-green); font-size: 1.1rem; }
        .pip-stat-value { color: #fff; text-shadow: 0 0 5px var(--pip-green); }
        .action-button {
            background-color: #0f150f; color: var(--pip-green); border: 1px solid var(--pip-green);
            padding: 10px; margin: 4px; cursor: pointer; text-transform: uppercase; font-size: 1.1rem;
            transition: all 0.1s; box-shadow: 0 0 5px rgba(57, 255, 20, 0.2);
        }
        .action-button:hover { background-color: var(--pip-dim); }
        .action-button:disabled { opacity: 0.4; cursor: not-allowed; }

        /* Allgemeine UI Komponenten */
        .level-bar {
            background-color: var(--pip-dim);
            border: 1px solid var(--pip-green);
            height: 10px;
            margin-top: 5px;
        }
        .level-progress {
            background-color: var(--pip-green);
            height: 100%;
            transition: width 0.5s ease;
        }
        
        #log-area {
            overflow-y: auto; 
            padding: 5px;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column-reverse; 
            animation: fadeInLog 0.3s ease-out;
            flex-grow: 1;
            min-height: 0; 
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--pip-green); border-radius: 3px; }
        ::-webkit-scrollbar-track { background: var(--pip-dark); }
    </style>
</head>
<body>

<div id="pipboy-case">
    <div id="game-screen">
        
        <header class="header-bar">
            <div class="flex flex-col sm:flex-row sm:items-baseline gap-1">
                <div class="font-bold tracking-widest text-lg sm:text-xl leading-none">PIP-BOY 3000 <span class="text-xs align-top opacity-70">MK-V</span></div>
                <div id="current-zone-display" class="text-xs sm:text-lg opacity-80 leading-none">Ödland</div>
            </div>
            
            <div class="flex items-center gap-1 sm:gap-2">
                <button id="new-game-btn" class="action-button px-2 py-1 text-xs leading-none bg-red-900 border-red-500" onclick="Game.initNewGame()">NEUES SPIEL</button>
                <button id="quit-btn" class="action-button px-2 py-1 text-xs leading-none bg-gray-700 border-gray-500" onclick="Game.quitGame()">BEENDEN</button>
                <button id="wiki-btn" class="action-button px-2 py-1 text-sm leading-none" onclick="UI.switchView('wiki')">WIKI</button>
                <button id="map-btn" class="action-button px-2 py-1 text-sm leading-none" onclick="UI.switchView('worldmap')">MAP</button>
                <button id="char-btn" class="action-button px-2 py-1 text-sm leading-none" onclick="UI.switchView('character')">CHAR</button>
            </div>
        </header>

        <div id="system-status-bar" class="flex flex-row justify-between items-center text-sm md:text-base">
            <div id="health-ammo-group" class="flex items-center gap-4">
                <div class="flex items-center gap-1">
                    <span class="font-bold">TP:</span>
                    <span id="health-display" class="pip-stat-value">100/100</span>
                    <div class="w-24 bg-gray-900 h-3 border border-[#1a4d1a]">
                        <div id="hp-bar" class="bg-[#39ff14] h-full" style="width: 100%"></div>
                    </div>
                </div>

                <div class="flex items-center gap-1">
                    <span class="font-bold">LVL:</span>
                    <span id="level-display" class="pip-stat-value">1</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="font-bold">EXP:</span>
                    <span id="exp-current-display" class="pip-stat-value">0</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="font-bold">MUN:</span>
                    <span id="ammo-display" class="pip-stat-value">10</span>
                </div>
            </div>

            <div id="caps-group" class="text-yellow-400 font-bold text-lg">
                <span id="caps-display">0 Kronenkorken</span>
            </div>
        </div>


        <div id="main-content" class="flex flex-grow overflow-hidden">
            
            <div id="main-panel" class="flex flex-col flex-grow overflow-hidden">
                
                <div id="top-panel-area" class="flex flex-col md:flex-row flex-grow overflow-hidden">

                    <div id="view-content-area" class="flex-grow md:w-2/3">
                        </div>
                    
                    <div id="log-panel" class="flex flex-col flex-shrink-0 border-t-2 md:border-t-0 md:border-l-2 border-[#39ff14] md:w-1/3 min-h-[100px] md:min-h-0 bg-gray-800">
                        <h2 class="section-header p-1">MELDUNGS LOG</h2>
                        <div id="log-area" class="flex-grow overflow-y-auto"></div>
                    </div>

                </div>
                
                <div class="px-4 pt-2 flex-shrink-0">
                     <div class="pip-text min-h-[1.5em] italic text-center text-sm md:text-base" id="encounter-text">
                        System initialisiert...
                    </div>
                </div>

                <div id="action-area" class="flex gap-4 p-2 flex-shrink-0"> 
                    <div id="movement-container" class="flex-shrink-0">
                        <div id="movement-buttons" class="grid grid-cols-3 gap-1 w-32">
                             <div></div>
                             <button class="action-button p-0 h-10 w-10 text-xl" onclick="Game.movePlayer(0, -1)">▲</button>
                             <div></div>
                             
                             <button class="action-button p-0 h-10 w-10 text-xl" onclick="Game.movePlayer(-1, 0)">◀</button>
                             <div class="flex items-center justify-center text-xs text-gray-600 font-bold">●</div> 
                             <button class="action-button p-0 h-10 w-10 text-xl" onclick="Game.movePlayer(1, 0)">▶</button>
    
                             <div></div>
                             <button class="action-button p-0 h-10 w-10 text-xl" onclick="Game.movePlayer(0, 1)">▼</button>
                             <div></div>
                        </div>
                    </div>
                    
                    <div id="action-buttons" class="flex flex-wrap flex-grow justify-end"></div>
                </div>
                
                <button id="restart-button" class="action-button absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-red-900 border-red-500 text-white shadow-2xl z-50 w-64" style="display: none;">NEUSTART</button>
            </div>
        </div>
        
        <footer class="text-xs opacity-50 p-1 flex justify-end">
            PIP-BOY 3000 MK-V
        </footer>
    </div>
</div>

<script src="ui.js"></script>  <script src="game.js"></script> <script>
    // Initialisierung des Spiels nach dem Laden des DOM und der Skripte
    window.onload = () => {
        // Initiiere die UI-Referenzen
        UI.init(); 
        // Starte das Spiel (lädt automatisch die Map-View)
        Game.initNewGame();
    };
    
    // Globale Event Listener für die Bewegung
    window.addEventListener('keydown', (e) => {
        if(Game.gameState.currentView !== 'map' || Game.gameState.inDialog || Game.gameState.isGameOver) return;
        
        if(e.key === 'ArrowUp' || e.key === 'w' || e.key === 'W') Game.movePlayer(0, -1);
        else if(e.key === 'ArrowDown' || e.key === 's' || e.key === 'S') Game.movePlayer(0, 1);
        else if(e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') Game.movePlayer(-1, 0);
        else if(e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') Game.movePlayer(1, 0);
    });
</script>
</body>
</html>
