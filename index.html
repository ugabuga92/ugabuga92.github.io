<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pip-Boy 3003</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        :root { --pip-green: #1aff1a; --pip-dim: #0d330d; --pip-bg: #051105; }
        html, body { width: 100%; height: 100%; overflow: hidden; position: fixed; background: #000; color: var(--pip-green); font-family: 'VT323', monospace; user-select: none; -webkit-user-select: none; }
        .crt::before { content: " "; display: block; position: absolute; inset: 0; background: linear-gradient(rgba(18,16,16,0) 50%, rgba(0,0,0,0.15) 50%), linear-gradient(90deg, rgba(255,0,0,0.03), rgba(0,255,0,0.01), rgba(0,0,255,0.03)); z-index: 10; background-size: 100% 3px, 4px 100%; pointer-events: none; }
        .btn { background: #0f1f0f; color: var(--pip-green); border: 1px solid var(--pip-green); padding: 8px; margin: 2px; cursor: pointer; text-transform: uppercase; font-size: 1.2rem; display: flex; justify-content: center; align-items: center; width: 100%; }
        .btn:active { background: var(--pip-green); color: black; }
        #login-screen, #char-screen, #game-screen { position: absolute; inset: 0; background: #000; display: flex; flex-direction: column; }
        .box { border: 2px solid var(--pip-green); padding: 20px; text-align: center; width: 90%; max-width: 400px; margin: auto; }
        input { background: #000; border: 2px solid var(--pip-green); color: var(--pip-green); font-family: inherit; font-size: 20px; padding: 10px; width: 100%; margin-bottom: 10px; text-align: center; }
        #view-container { flex-grow: 1; position: relative; border-bottom: 2px solid var(--pip-green); overflow: hidden; }
        #log-panel { height: 30%; background: #020a02; display: flex; flex-direction: column; }
        .char-slot { border: 1px solid #0d330d; padding: 10px; margin-bottom: 5px; cursor: pointer; }
        .char-slot.active { background: var(--pip-green); color: black; }
        /* Mobile Layout Fixes */
        #game-layout { display: flex; flex-direction: column; height: 100%; width: 100%; }
        @media (min-width: 768px) { #game-layout { flex-direction: row; } #view-container { width: 75%; height: 100%; border-bottom: none; border-right: 2px solid var(--pip-green); } #log-panel { width: 25%; height: 100%; } }
    </style>
</head>
<body>
<div id="pipboy-case" class="w-full h-full">
    <div id="login-screen" class="crt">
        <div class="box">
            <h1 class="text-5xl font-bold mb-4">PIP-BOY 3003</h1>
            <input type="email" id="login-email" placeholder="E-MAIL">
            <input type="password" id="login-pass" placeholder="PASSWORT">
            <input type="text" id="login-name" placeholder="NAME" style="display:none">
            <button id="btn-login" class="btn font-bold">LOGIN</button>
            <button id="btn-reg-toggle" class="text-sm text-yellow-400 mt-2">Account erstellen</button>
            <div id="login-status" class="mt-4 text-red-500 font-bold"></div>
        </div>
    </div>

    <div id="char-screen" style="display:none;" class="crt">
        <div class="box">
            <h2 class="text-3xl text-yellow-400 mb-4">CHARAKTER WAHL</h2>
            <div id="char-list" class="flex flex-col gap-2 mb-4"></div>
            <button id="btn-char-action" class="btn border-yellow-400 text-yellow-400">LADE...</button>
            <button id="btn-char-delete" class="btn border-red-500 text-red-500 hidden">LÖSCHEN</button>
            <button onclick="location.reload()" class="btn border-gray-500 text-gray-500 mt-2">ABMELDEN</button>
        </div>
    </div>

    <div id="new-char-overlay" style="display:none;" class="absolute inset-0 z-50 bg-black/90 flex justify-center items-center">
        <div class="box border-yellow-400">
            <h2 class="text-2xl text-yellow-400 mb-2">NEUE IDENTITÄT</h2>
            <input type="text" id="new-char-input" class="border-yellow-400 text-yellow-400" placeholder="NAME">
            <button id="btn-create-confirm" class="btn border-yellow-400 text-yellow-400">STARTEN</button>
            <button onclick="document.getElementById('new-char-overlay').style.display='none'" class="btn">ABBRUCH</button>
        </div>
    </div>

    <div id="game-screen" style="display:none;">
        <header class="h-16 border-b-2 border-[#1aff1a] flex items-center justify-between px-2 bg-[#001100]">
            <div>
                <div class="text-xl font-bold text-cyan-400" id="val-name">PLAYER</div>
                <div class="text-xs text-yellow-400">HP <span id="val-hp">100/100</span> | LVL <span id="val-lvl">1</span></div>
            </div>
            <button id="btn-menu" class="btn w-auto px-4">MENÜ</button>
        </header>
        <div id="game-layout">
            <div id="view-container" class="crt">
                <div id="overlay-controls"></div>
                <div id="dialog-overlay" style="display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); z-index:50;"></div>
            </div>
            <div id="log-panel">
                <div class="bg-[#1aff1a] text-black font-bold px-2">LOG</div>
                <div id="log-area" class="flex-grow overflow-y-auto p-2 text-xs flex flex-col-reverse text-green-400 font-mono"></div>
            </div>
        </div>
        <div id="main-menu" style="display:none;" class="absolute top-16 right-0 w-48 bg-black border-2 border-[#1aff1a] p-2 z-50">
            <button onclick="UI.toggleView('inventory')" class="btn">INVENTAR</button>
            <button onclick="UI.toggleView('char')" class="btn">STATUS</button>
            <button onclick="UI.toggleView('worldmap')" class="btn">KARTE</button>
            <button onclick="UI.toggleView('wiki')" class="btn">WIKI</button>
            <button onclick="Game.saveGame(true)" class="btn border-yellow-400 text-yellow-400">SPEICHERN</button>
            <button onclick="location.reload()" class="btn border-red-500 text-red-500">LOGOUT</button>
        </div>
    </div>
</div>
<script>
    const ver = Date.now();
    function load(s) { return new Promise((r,e) => { const el=document.createElement('script'); el.src=s+"?v="+ver; el.onload=r; el.onerror=e; document.body.appendChild(el); }); }
    window.onload = () => {
        load('data.js').then(()=>load('world_gen.js')).then(()=>load('network.js')).then(()=>load('ui.js')).then(()=>load('combat.js')).then(()=>load('game.js'))
        .then(()=> { if(typeof UI!=='undefined') UI.init(); else console.error("UI missing"); })
        .catch(e => { document.getElementById('login-status').textContent = "LADEFEHLER: " + e.message; });
    };
</script>
</body>
</html>
